/*
jsrand v1.0
https://github.com/DomenicoDeFelice/jsrand
@license
*/
if(!window.dfd){window.dfd={}}dfd.Srand=Srand=function(e){var n=function(e){if(e!==undefined){this.seed(e)}else{this.randomize()}};n._oldSrand=e;return n}(window.Srand);Srand.prototype={};Srand.seed=Srand.prototype.seed=function(e){if(e===undefined){return this._seed}this._mz=123456789;return this._mw=this._seed=e};Srand.randomize=Srand.prototype.randomize=function(){var e=this.randomIntegerIn(1,4294967295,Math.random());this.seed(e);return e};Srand.random=Srand.prototype.random=function(){if(this._seed===undefined){this.randomize()}var e=this._mz;var n=this._mw;e=(e&65535)*36969+(e>>16)&4294967295;n=(n&65535)*18e3+(n>>16)&4294967295;this._mz=e;this._mw=n;var t=((e<<16)+n&4294967295)/4294967296;return.5+t};Srand.randomIn=Srand.prototype.randomIn=function(e,n,t){if(t===undefined){t=this.random()}return e+t*(n-e)};Srand.randomIntegerIn=Srand.prototype.randomIntegerIn=function(e,n,t){if(t===undefined){t=this.random()}return e+Math.floor(t*(n-e+1))};Srand.noConflict=function(){Srand=dfd.Srand._oldSrand;return dfd.Srand};/*
  A nonogram game written in javascript
  https://github.com/DomenicoDeFelice/Pi-Nonograms

  Play the game: http://freenonograms.altervista.org

  Copyright (c) 2013-2015 Domenico De Felice

  @license

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
!function(e){if(!e.dfd){e.dfd={}}dfd.Event=function(e){this._sender=e;this._listeners=[]};dfd.Event.prototype.attach=function n(e){this._listeners.push(e)};dfd.Event.prototype.notify=function t(e){for(var n=0,t=this._listeners.length;n<t;n++){this._listeners[n](this._sender,e)}}}(window);!function(e){if(!e.dfd){e.dfd={}}if(!dfd.nonograms){dfd.nonograms={}}dfd.nonograms.DragHelper=function(){this._dragging=false};dfd.nonograms.DragHelper.prototype={start:function(e,n,t){this._x1=this._x2=e;this._y1=this._y2=n;this._guess=t;this._dragging=true},to:function(e,n){this._x2=e;this._y2=n},stop:function(){this._dragging=false},isDragging:function(){return this._dragging},iterateOverDraggedCells:function(e){var n=this._x1;var t=this._y1;var i=this._x2;var s=this._y2;var o,r,d,a,h,l;if(Math.abs(n-i)>Math.abs(t-s)){d=1;l=0;a=h=t;if(n<i){o=n;r=i}else{o=i;r=n}}else{d=0;l=1;o=r=n;if(t<s){a=t;h=s}else{a=s;h=t}}for(var f=o,u=a;f<=r&&u<=h;f+=d,u+=l){e(f,u,this._guess)}}}}(window);!function(e){if(!e.dfd){e.dfd={}}if(!dfd.nonograms){dfd.nonograms={}}dfd.nonograms.Model=function(e){if(!e)e={};this.width=e.width;this.height=e.height;this._srand=e.srand;this.events={};this.events.guessChanged=new dfd.Event(this);this.events.nonogramChanged=new dfd.Event(this);this.events.nonogramSolved=new dfd.Event(this);this.events.nonogramUnsolved=new dfd.Event(this);this._setupNonogram();this.setMode(e.mode)};dfd.nonograms.Model.prototype={getCellAt:function(e,n){var t;if(n===undefined){t=e}else{t=this._indexFromXY(e,n)}var i=this._actual[t];return i===undefined?"empty":i},getGuessAt:function(e,n){var t;if(n===undefined){t=e}else{t=this._indexFromXY(e,n)}var i=this._guess[t];return i===undefined?"unknown":i},setGuessAt:function(e,n,t){var i;if(t===undefined){t=n;i=e}else{i=this._indexFromXY(e,n)}var s=this.getGuessAt(i);this._guess[i]=t;this.events.guessChanged.notify({x:e,y:n,oldGuess:s,newGuess:t});if(this._mode==="play")this._checkIfSolved()},getMode:function(){return this._mode},setMode:function(e){if(e===this._mode)return;this._mode=e;if(e==="draw"){this._guess=this._actual}else{var n=this.width*this.height;this._guess=new Array(n)}this._setUnsolved();this.events.nonogramChanged.notify()},isSolved:function(){return this._solved},getRowDefinition:function(e){var n=[];var t;var i;var s;var o=0;var r=this._mode;for(var d=0;d<this.width;d++){if(this.getCellAt(d,e)==="filled"){if(o===0)t=d;o++}else if(o){i=d-1;s=false;if(r==="play"){if((t===0||this.getGuessAt(t-1,e)==="empty")&&(i===this.width-1||this.getGuessAt(i+1,e)==="empty")){s=true;for(var a=t;a<=i;a++){if(this.getGuessAt(a,e)!=="filled"){s=false;break}}}}n.push({length:o,solved:s});o=0}}if(o){i=d-1;s=false;if(r==="play"){if((t===0||this.getGuessAt(t-1,e)==="empty")&&(i===this.width-1||this.getGuessAt(i+1,e)==="empty")){s=true;for(var a=t;a<=i;a++){if(this.getGuessAt(a,e)!=="filled"){s=false;break}}}}n.push({length:o,solved:s})}return n},getColumnDefinition:function(e){var n=[];var t;var i;var s;var o=0;var r=this._mode;for(var d=0;d<this.height;d++){if(this.getCellAt(e,d)==="filled"){if(o===0)t=d;o++}else if(o){i=d-1;s=false;if(r==="play"){if((t===0||this.getGuessAt(e,t-1)==="empty")&&(i===this.height-1||this.getGuessAt(e,i+1)==="empty")){s=true;for(var a=t;a<=i;a++){if(this.getGuessAt(e,a)!=="filled"){s=false;break}}}}n.push({length:o,solved:s});o=0}}if(o){i=d-1;s=false;if(r==="play"){if((t===0||this.getGuessAt(e,t-1)==="empty")&&(i===this.height-1||this.getGuessAt(e,i+1)==="empty")){s=true;for(var a=t;a<=i;a++){if(this.getGuessAt(e,a)!=="filled"){s=false;break}}}}n.push({length:o,solved:s})}return n},giveHint:function(){if(this.isSolved()||this._mode!=="play")return;var e=this.width*this.height;var n=this._actual;var t=this._guess;var i,s,o;for(var r=e;r--;){if(t[r]==="filled"&&n[r]!=="filled"||t[r]==="empty"&&n[r]==="filled"){i=this._XYFromIndex(r);s=i[0];o=i[1];this.setGuessAt(s,o,this.getCellAt(s,o));return}}do{i=this._getRandomXY();s=i[0];o=i[1]}while(this.getGuessAt(s,o)!=="unknown");this.setGuessAt(s,o,this.getCellAt(s,o))},randomize:function(e){this._setupNonogram();this._mode="play";var n=this._actual;var t=this.width*this.height;var i=Math.floor(t*e);if(i>t)i=t;var s;while(i){s=this._getRandomIndex();if(n[s]===undefined){n[s]="filled";i--}}this.events.nonogramChanged.notify()},resetGuesses:function(){var e=this.width*this.height;this._guess=new Array(e);if(this._mode==="draw"){this._actual=this._guess}this._solved=false;this.events.nonogramChanged.notify()},_setupNonogram:function(){var e=this.width*this.height;this._actual=new Array(e);this._guess=new Array(e);this._setUnsolved()},_indexFromXY:function(e,n){return n*this.width+e},_XYFromIndex:function(e){var n=this.width;var t=Math.floor(e/n);var i=e%n;return[i,t]},_getRandomIndex:function(){var e=this.width*this.height;return this._srand.randomIntegerIn(0,e-1)},_getRandomXY:function(){var e=this._srand.randomIntegerIn(0,this.width-1);var n=this._srand.randomIntegerIn(0,this.height-1);return[e,n]},_setSolved:function(){if(!this.isSolved()){this._solved=true;this.events.nonogramSolved.notify()}},_setUnsolved:function(){if(this.isSolved()){this._solved=false;this.events.nonogramUnsolved.notify()}},_checkIfSolved:function(){var e=this._actual;var n=this._guess;for(var t=e.length;t--;){if(e[t]==="filled"&&n[t]!=="filled"||e[t]!=="filled"&&n[t]==="filled"){this._setUnsolved();return}}this._setSolved()}}}(window);!function(e,n){if(!e.dfd){e.dfd={}}if(!dfd.nonograms){dfd.nonograms={}}dfd.nonograms.View=function(e,t){this._model=e;this._$container=n(t);this._$nonogram=null;this._theme="classic";var i;do{i="nonogram-"+dfd.Srand.randomIntegerIn(0,1e6,Math.random())}while(n("#"+i).length);this._id=i;this.events={};this.events.mouseDownOnCell=new dfd.Event(this);this.events.mouseUp=new dfd.Event(this);this.events.mouseEntersCell=new dfd.Event(this);this.events.mouseLeavesCell=new dfd.Event(this)};dfd.nonograms.View.prototype={show:function(){this.rebuildNonogram()},setSolved:function(){this._$nonogram.removeClass("nonogram_playing").addClass("nonogram_solved")},setUnsolved:function(){this._$nonogram.removeClass("nonogram_solved").addClass("nonogram_playing")},setTheme:function(e){if(this._$nonogram){this._$nonogram.removeClass(this._theme).addClass(e)}this._theme=e},highlightColumn:function(e){this._$container.find(".nonogram_column_"+e+"_cell").addClass("nonogram_hovered_column");this._$container.find("#"+this._idOfColumnDefinition(e)).addClass("nonogram_hovered_column")},unhighlightColumn:function(e){this._$container.find(".nonogram_column_"+e+"_cell").removeClass("nonogram_hovered_column");this._$container.find("#"+this._idOfColumnDefinition(e)).removeClass("nonogram_hovered_column")},setGuessAt:function(e,t,i){var s=n("#"+this._idOfCell(e,t));var o=s.data().guess;s.removeClass("nonogram_correct_guess").removeClass(this._guessToCSSClass(o)).addClass(this._guessToCSSClass(i)).data({guess:i});if(this._model.getCellAt(e,t)===i){s.addClass("nonogram_correct_guess")}n("#"+this._idOfRowDefinition(t)).html(this._rowDefinitionToHTML(this._model.getRowDefinition(t)));n("#"+this._idOfColumnDefinition(e)).html(this._columnDefinitionToHTML(this._model.getColumnDefinition(e)))},rebuildNonogram:function(){var e=this._model.width,t=this._model.height;var i,s,o;var r=this._$nonogram=n("<table>").attr("id",this._id).addClass("nonogram").addClass(this._theme);if(this._model.isSolved()){r.addClass("nonogram_solved")}else{r.addClass("nonogram_playing")}o=n("<tr>").addClass("nonogram_row");n("<td>").addClass("nonogram_top_left_cell").appendTo(o);for(i=0;i<e;i++){if(i&&i%5===0){n("<td>").addClass("nonogram_separation_column").appendTo(o)}n("<td>").attr("id",this._idOfColumnDefinition(i)).addClass("nonogram_definition nonogram_column_definition").html(this._columnDefinitionToHTML(this._model.getColumnDefinition(i))).appendTo(o)}o.appendTo(r);for(s=0;s<t;s++){if(s&&s%5===0){n("<tr>").addClass("nonogram_separation_row").append(n('<td colspan="'+(e+e-1)+'">')).appendTo(r)}o=n("<tr>").addClass("nonogram_row");n("<td>").attr("id",this._idOfRowDefinition(s)).addClass("nonogram_definition nonogram_row_definition").html(this._rowDefinitionToHTML(this._model.getRowDefinition(s))).appendTo(o);for(i=0;i<e;i++){if(i&&i%5===0){n("<td>").addClass("nonogram_separation_column").appendTo(o)}n("<td>").attr("id",this._idOfCell(i,s)).addClass(this._CSSClassesForCell(i,s)).data({x:i,y:s,guess:this._model.getGuessAt(i,s)}).appendTo(o)}o.appendTo(r)}this._setupEventHandlers(r);this._$container.finish().hide().empty().append(r).show()},_setupEventHandlers:function(e){var t=this;e.on("mousedown","td",function(e){if(e.which!==1)return;e.preventDefault();var i=n(e.target).data();t.events.mouseDownOnCell.notify(i)});var i=function(){if(!n.contains(document,e[0])){n(document).unbind("mouseup",i)}else{t.events.mouseUp.notify()}};n(document).on("mouseup",i);e.on("mouseover","td",function(e){e.preventDefault();var i=n(e.target).data();t.events.mouseEntersCell.notify(i)});e.on("mouseout","td",function(e){e.preventDefault();var i=n(e.target).data();t.events.mouseLeavesCell.notify(i)})},_idOfCell:function(e,n){return this._id+"_x_"+e+"_y_"+n},_idOfRowDefinition:function(e){return this._id+"_row_"+e+"_definition"},_idOfColumnDefinition:function(e){return this._id+"_column_"+e+"_definition"},_rowDefinitionToHTML:function(e){var n="<nobr>";var t=e.length;for(var i=0;i<t;i++){if(i)n+="&nbsp;";n+='<span class="nonogram_sequence';if(e[i].solved){n+=" nonogram_solved_sequence"}n+='">'+e[i].length+"</span>"}n+="</nobr>";return n},_columnDefinitionToHTML:function(e){var n="";var t=e.length;for(var i=0;i<t;i++){if(i)n+="<br>";n+='<nobr><span class="nonogram_sequence';if(e[i].solved){n+=" nonogram_solved_sequence"}n+='">'+e[i].length+"</span></nobr>"}return n},_CSSClassesForCell:function(e,n){var t=this._model.getGuessAt(e,n);var i=this._model.getCellAt(e,n);var s=[];s.push("nonogram_cell");s.push("nonogram_column_"+e+"_cell");s.push(this._guessToCSSClass(t));if(t===i){s.push("nonogram_correct_guess")}return s.join(" ")},_guessToCSSClass:function(e){return"nonogram_"+e+"_cell"}}}(window,jQuery);!function(e){if(!e.dfd){e.dfd={}}if(!dfd.nonograms){dfd.nonograms={}}dfd.nonograms.Controller=function(e,n){this._dragHelper=new dfd.nonograms.DragHelper;this._model=e;this._view=n;var t=this;e.events.nonogramChanged.attach(function(){n.rebuildNonogram()});e.events.guessChanged.attach(function(e,t){n.setGuessAt(t.x,t.y,t.newGuess)});e.events.nonogramSolved.attach(function(){n.setSolved()});e.events.nonogramUnsolved.attach(function(){n.setUnsolved()});n.events.mouseDownOnCell.attach(function(n,i){t._dragHelper.start(i.x,i.y,t._nextGuess(e.getGuessAt(i.x,i.y)));t._previewDragging()});n.events.mouseUp.attach(function(){if(!t._dragHelper.isDragging())return;t._dragHelper.stop();t._cancelDraggingPreview();t._applyDragging()});n.events.mouseEntersCell.attach(function(e,n){e.highlightColumn(n.x);if(!t._dragHelper.isDragging())return;t._cancelDraggingPreview();t._dragHelper.to(n.x,n.y);t._previewDragging()});n.events.mouseLeavesCell.attach(function(e,n){e.unhighlightColumn(n.x)})};dfd.nonograms.Controller.prototype={_nextGuess:function(e){if(e==="unknown"){return"filled"}else if(e==="filled"){return"empty"}return"unknown"},_previewDragging:function(){var e=this._view;this._dragHelper.iterateOverDraggedCells(function(n,t,i){e.setGuessAt(n,t,i)})},_applyDragging:function(){var e=this._model;this._dragHelper.iterateOverDraggedCells(function(n,t,i){e.setGuessAt(n,t,i)})},_cancelDraggingPreview:function(){var e=this._model;var n=this._view;this._dragHelper.iterateOverDraggedCells(function(t,i,s){n.setGuessAt(t,i,e.getGuessAt(t,i))})}}}(window);!function(e){if(!e.dfd){e.dfd={}}if(!dfd.nonograms){dfd.nonograms={}}dfd.nonograms.Nonogram=function(e,n){var t,i,s;var o=dfd.nonograms.Nonogram.options;n=n||{};for(var r in o){n[r]=n[r]||o[r]}t=new dfd.nonograms.Model({width:n.width,height:n.height,srand:n.srand,mode:n.mode});t.events.nonogramSolved.attach(n.onSolved);i=new dfd.nonograms.View(t,e);i.setTheme(n.theme);s=new dfd.nonograms.Controller(t,i);this._model=t;this._view=i;this._controller=s;this._container=e;this._opts=n};dfd.nonograms.Nonogram.options={width:10,height:10,mode:"play",theme:"classic",srand:dfd.Srand,onSolved:function(){alert("Congratulations! Nonogram solved!")}};dfd.nonograms.Nonogram.prototype={show:function(){this._view.show()},randomize:function(e){var n=.6;if(e&&e.density){n=e.density}this._model.randomize(n)},giveHint:function(){this._model.giveHint()},startOver:function(){this._model.resetGuesses()},setTheme:function(e){this._opts.theme=e;this._view.setTheme(e)},getMode:function(){return this._model.getMode()},setMode:function(e){this._model.setMode(e)},showGameState:function(){}}}(window);
//# sourceMappingURL=pi-nonograms.js.map